{% extends 'pokedex/layout.html' %} {% block body %}
<div id="pokedex"></div>

<div id="scroll"></div>

<script type="text/babel">
  function Pokedex() {
    const { useEffect, useState } = React;
    const [currentIndex, setIndex] = React.useState(0);
    const [pokemonList, setPokemonList] = React.useState([]);
    const [selectedPokemon, setSelectedPokemon] = React.useState({});
    const [isViewDetail, setIsViewDetail] = React.useState(false)

    useEffect(() => {
      fetch("/pokemon")
        .then((response) => response.json())
        .then((result) => {
          setPokemonList(result.pokemon);
        })
        .catch((error) => console.error("Error fetching data:", error));
    }, []);

    const selectNext = () => {
      if (currentIndex < pokemonList.length - 1) {
        setIndex(currentIndex + 1);
      } else {
        fetch("/pokemon-next")
          .then((response) => response.json())
          .then((result) => {
            setIndex(result.index);
            setPokemonList(result.pokemon);
          });
      }
    };

    const selectPrevious = () => {
      if (currentIndex > 0) {
        setIndex(currentIndex - 1);
      } else {
        fetch("/pokemon-previous")
          .then((response) => response.json())
          .then((result) => {
            setIndex(result.index);
            setPokemonList(result.pokemon);
          });
      }
    };

    const selectItem = () => {
      fetch(`pokemon/${pokemonList[currentIndex].name}`)
        .then((response) => response.json())
        .then((result) => {
          setSelectedPokemon(result.pokemon);
        });
    };

    const backFunction = () => {
      setSelectedPokemon({});
    };

    return (
      <div className="pokedex">
        <LeftPanelDisplay
          data={pokemonList}
          selectNext={selectNext}
          selectPrevious={selectPrevious}
          currentIndex={currentIndex}
          selectItem={selectItem}
          pokemonImage={selectedPokemon.image}
          backFunction={backFunction}
        />

        <RightPanelDisplay selectedPokemon={selectedPokemon}/>
      </div>
    );
  }

  const LeftPanelDisplay = ({
    data,
    selectNext,
    selectPrevious,
    currentIndex,
    selectItem,
    pokemonImage,
    backFunction,
  }) => {
    return (
      <div class="left-panel">
        <div class="top-shadow">
          <div class="top-bar">
            <div class="light-layout">
              <div class="blue-frame">
                <div class="blue-light"></div>
              </div>

              <div class="red-light"></div>
              <div class="yellow-light"></div>
              <div class="green-light"></div>
            </div>
          </div>
        </div>
        <div class="left-panel-layout">
          <div class="left-layout">
            <div class="display">
              <div class="display-top">
                <div class="red-dot"></div>
                <div class="red-dot"></div>
              </div>
              <Screen
                data={data}
                currentIndex={currentIndex}
                pokemonImage={pokemonImage}
              />
              <div class="display-bottom">
                <div class="bottom-red-dot"></div>
                <div>
                  <div class="grill"></div>
                  <div class="grill"></div>
                  <div class="grill"></div>
                  <div class="grill"></div>
                </div>
              </div>
            </div>

            <Controls
              selectNext={selectNext}
              selectPrevious={selectPrevious}
              selectItem={selectItem}
              backFunction={backFunction}
            />
          </div>

          <div class="side-hinge">
            <div class="top-hinge"></div>
            <div class="bottom-hinge"></div>
          </div>
        </div>
      </div>
    );
  };

  const Screen = ({ data, currentIndex, pokemonImage }) => {
    return (
      <div className="screen">
        {pokemonImage ? (
          <img className="pokemonImage" src={pokemonImage} alt="Pokemon" />
          
        ) : (
          <ul className="list">
            {data.map((item, index) => (
              <li
                className={index === currentIndex ? "select-item" : ""}
                key={item.id}
              >
                {item.name}
              </li>
            ))}
          </ul>
        )}
      </div>
    );
  };

  const Controls = ({
    selectNext,
    selectPrevious,
    selectItem,
    backFunction,
  }) => {
    return (
      <div className="controls">
        <div className="select-btn" onClick={selectItem}>ENTER</div>
        <div className="middle-control">
          <div className="bar">
            <div className="red-bar"></div>
            <div className="blue-bar"></div>
          </div>
          <div className="green-box"></div>
        </div>
        <div className="dpad-control">
          <div></div>
          <div className="dpad-up" onClick={selectPrevious}>
            <div className="dpad-arrow-outline-up">
              <div className="dpad-arrow-up"></div>
            </div>
          </div>
          <div></div>
          <div className="dpad-left" onClick={backFunction}>
            <div className="dpad-arrow-outline-left">
              <div className="dpad-arrow-left"></div>
            </div>
          </div>
          <div className="dpad-middle">
            <div className="dpad-circle"></div>
          </div>
          <div className="dpad-right">
            <div className="dpad-arrow-outline-right">
              <div className="dpad-arrow-right"></div>
            </div>
          </div>
          <div></div>
          <div className="dpad-down" onClick={selectNext}>
            <div className="dpad-arrow-outline-down">
              <div className="dpad-arrow-down"></div>
            </div>
          </div>
          <div></div>
        </div>
      </div>
    );
  };

  const RightPanelDisplay = ({selectedPokemon}) =>{
    const { useEffect, useState } = React;

    const [selectedTab, setSelectedTab] = React.useState("info");

    const selectTab = (tab) => {
      setSelectedTab(tab);
    };

    return (
      <div className="right-panel">
        <div className="top-outline">
          <div className="top-bg"></div>
        </div>
        <div className="right-panel-body">
          <div className="right-layout">
            <DetailScreen selectedTab={selectedTab} selectedPokemon={selectedPokemon} />
            <DetailControls selectTab={selectTab} />
            <div className="right-top-btn">
              <div className="top-red-lights">
                <div className="top-red-light"></div>
                <div className="top-red-light"></div>
              </div>
              <div className="top-black-bars">
                <div className="top-black-bar"></div>
                <div className="top-black-bar"></div>
              </div>
            </div>
            <div className="right-middle-btn">
              <div className="white-btns">
                <div className="white-btn">UP</div>
                <div className="white-btn">DOWN</div>
              </div>
              <div className="yellow-btn"></div>
            </div>
            <div className="right-bottom-btn">
              <div className="bottom-btn"></div>
              <div className="bottom-btn"></div>
            </div>
          </div>
        </div>
      </div>
    );
  }

  function DetailScreen({ selectedTab, selectedPokemon }) {
    return (
    <div className="detail-screen">
      {selectedPokemon && (
        <React.Fragment>
          <div className={`display-info ${selectedTab === "info" ? "" : "hide-detail"}`}>
            {selectedPokemon.name ? <div>Name: {selectedPokemon.name}</div>:""}
            
          </div>
          <div className={`display-info ${selectedTab === "desc" ? "" : "hide-detail"}`}>
            {selectedPokemon.desc ? <div> {selectedPokemon.desc}</div>:""}
          </div>
          <div className={`display-info ${selectedTab === "stats" ? "" : "hide-detail"}`}>
            {selectedPokemon.stat && selectedPokemon.stat.health
              ? 
              <div>Health: {selectedPokemon.stat.health} </div>
              : ""}
          </div>
          <div className={`display-info ${selectedTab === "moves" ? "" : "hide-detail"}`}>
            <ul className="list ">
              {selectedPokemon.moves && selectedPokemon.moves.length > 0 ? (
                selectedPokemon.moves.map((move, index) => (
                  <React.Fragment key={index}>
                    <div className="move-list-display">
                      <li>{move.name}</li>
                      <img src={move.type && move.type.image} className="icon-image" alt={move.name} />
                    </div>
                  </React.Fragment>
                ))
              ) : (<div></div> )}
            </ul>
          </div>
        </React.Fragment>
      )}
    </div>
  );
  }

  function DetailControls({ selectTab }) {
    return (
      <div className="blue-btn-layout">
        <div className="blue-button-info" onClick={() => selectTab("info")}>
          INFO
        </div>
        <div className="blue-button-desc" onClick={() => selectTab("desc")}>
          DESC.
        </div>
        <div className="blue-button-stats" onClick={() => selectTab("stats")}>
          STATS
        </div>
        <div className="blue-button-moves" onClick={() => selectTab("moves")}>
          MOVES
        </div>
        <div className="blue-button"></div>
        <div className="blue-button"></div>
        <div className="blue-button"></div>
        <div className="blue-button"></div>
        <div className="blue-button"></div>
        <div className="blue-button"></div>
      </div>
    );
  }

  ReactDOM.render(<Pokedex />, document.querySelector("#pokedex"));

</script>
{% endblock %}
