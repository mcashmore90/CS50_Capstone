{% extends 'pokedex/layout.html' %}
{% block body %}
<div id="pokedex"></div>

<script type="text/babel">

function Pokedex() {
    const { useEffect, useState } = React;
    const [currentIndex, setIndex] = React.useState(0)
    const [pokemonList, setPokemonList] = React.useState([])

    useEffect(() => {
        fetch('/pokemon')
          .then(response => response.json())
          .then(result => {
            setPokemonList(result.pokemon);
            console.log(currentIndex)
            console.log(pokemonList)
          })
          .catch(error => console.error('Error fetching data:', error));
      }, []);

      useEffect(()=>{
        console.log(currentIndex)
      },[currentIndex]);

      const handleClickEvent = () => {
        setIndex(currentIndex + 1);
        alert('Button clicked in child, called parent function!');
      };

      const selectNext = () => {
        console.log('clicked')

        if (currentIndex < pokemonList.length - 1) {
            setIndex(currentIndex + 1);
        }
        else{
            fetch("/pokemon-next")
            .then(response=>response.json())
            .then(result=>{
                setIndex(result.index)
                setPokemonList(result.pokemon)
            })
        }
    };

    return (
      <div className="pokedex">
        <LeftPanelDisplay data={pokemonList} clickEventClick={selectNext} />
        <RightPanelDisplay />
      </div>
    );
  }

  const LeftPanelDisplay = ({ data, clickEventClick }) => {
    return (
      <div class="left-panel">
        <div class="top-shadow">
          <div class="top-bar">
            <div class="light-layout">
              <div class="blue-frame">
                <div class="blue-light"></div>
              </div>

              <div class="red-light"></div>
              <div class="yellow-light"></div>
              <div class="green-light"></div>
            </div>
          </div>
        </div>
        <div class="left-panel-layout">
          <div class="left-layout">
            <div class="display">
              <div class="display-top">
                <div class="red-dot"></div>
                <div class="red-dot"></div>
              </div>
              <Screen data={data}/>
              <div class="display-bottom">
                <div class="bottom-red-dot"></div>
                <div>
                  <div class="grill"></div>
                  <div class="grill"></div>
                  <div class="grill"></div>
                  <div class="grill"></div>
                </div>
              </div>
            </div>

            <Controls handleClick={clickEventClick} />
          </div>

          <div class="side-hinge">
            <div class="top-hinge"></div>
            <div class="bottom-hinge"></div>
          </div>
        </div>
      </div>
    );
  }

const Screen=({data})=> {
    const [currentIndex, setIndex] = React.useState(0)
    return (
        <div className="screen">
            <ul className="list">
                {data.map((item, index) => (
                    <li className={index === currentIndex ? 'select-item' : ''}
                        key={item.id}
                    >
                        {item.name}
                    </li>
                ))}
            </ul>
        </div>
    );
  }

const Controls = ({ handleClick }) =>{

    return (
      <div className="controls">
        <div className="select-btn"></div>
        <div className="middle-control">
          <div className="bar">
            <div className="red-bar"></div>
            <div className="blue-bar"></div>
          </div>
          <div className="green-box"></div>
        </div>
        <div className="dpad-control">
          <div></div>
          <div className="dpad-up">
            <div className="dpad-arrow-outline-up">
              <div className="dpad-arrow-up"></div>
            </div>
          </div>
          <div></div>
          <div className="dpad-left">
            <div className="dpad-arrow-outline-left">
              <div className="dpad-arrow-left"></div>
            </div>
          </div>
          <div className="dpad-middle">
            <div className="dpad-circle"></div>
          </div>
          <div className="dpad-right">
            <div className="dpad-arrow-outline-right">
              <div className="dpad-arrow-right"></div>
            </div>
          </div>
          <div></div>
          <div className="dpad-down"  onClick={handleClick}>
            <div className="dpad-arrow-outline-down">
                <div className="dpad-arrow-down"></div>
            </div>
          </div>
          <div></div>
        </div>
      </div>

      
    );
  }

  function RightPanelDisplay() {
    return (
      <div className="right-panel">
        <div className="top-outline">
          <div className="top-bg"></div>
        </div>
        <div className="right-panel-body">
          <div className="right-layout">
            <DetailScreen />
            <DetailControls />
            <div className="right-top-btn">
              <div className="top-red-lights">
                <div className="top-red-light"></div>
                <div className="top-red-light"></div>
              </div>
              <div className="top-black-bars">
                <div className="top-black-bar"></div>
                <div className="top-black-bar"></div>
              </div>
            </div>
            <div className="right-middle-btn">
              <div className="white-btns">
                <div className="white-btn"></div>
                <div className="white-btn"></div>
              </div>
              <div className="yellow-btn"></div>
            </div>
            <div className="right-bottom-btn">
              <div className="bottom-btn"></div>
              <div className="bottom-btn"></div>
            </div>
          </div>
        </div>
      </div>
    );
  }

  function DetailScreen() {
    return (
      <div className="detail-screen">
        <div className="display-info">
          <div>
            <div>________</div>
            <div>bulbasaur</div>
            <div>id: 1</div>
          </div>
          <div>
            <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/types/generation-iii/colosseum/12.png" />
            <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/types/generation-iii/colosseum/4.png" />
            <div>height: 7</div>
            <div>weight: 50</div>
          </div>
        </div>
        <div className="display-desc hide-detail">bbbb</div>
        <div className="display-stats hide-detail">cccc</div>
        <div className="display-moves hide-detail">dddd</div>
      </div>
    );
  }

  function DetailControls() {
    return (
      <div className="blue-btn-layout">
        <div className="blue-button-info">INFO</div>
        <div className="blue-button-desc">DESC.</div>
        <div className="blue-button-stats">STATS</div>
        <div className="blue-button-moves">MOVES</div>
        <div className="blue-button"></div>
        <div className="blue-button"></div>
        <div className="blue-button"></div>
        <div className="blue-button"></div>
        <div className="blue-button"></div>
        <div className="blue-button"></div>
      </div>
    );
  }

  ReactDOM.render(<Pokedex />, document.querySelector("#pokedex"));
</script>
{% endblock %}
