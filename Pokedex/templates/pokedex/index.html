{%extends "pokedex/layout.html"%} {%block body%}


<div style="display:flex">
    <div id="list" style="width: 25%;"></div>

    <div id="detail" style="width: 50%;"></div>
    <div id="other"></div>
</div>


<script type="text/babel">

    function Detail(prop){

        if (prop && prop.pokemon){
            return (
            <div className="container-size">
                <div className="container-direction">
                  <div>
                    {prop.pokemon.types.map((type)=>(
                         <img src={type.image} className="icon-image"/>
                    ))}
                   
                  </div>
                  <img src={prop.pokemon.image}  className="pokemon-image"/>
                </div>
                <div>
                  <ul>
                    <li>Health: {prop.pokemon.stat.health}</li>
                    <li>Attack: {prop.pokemon.stat.attack}</li>
                    <li>Defence: {prop.pokemon.stat.defence}</li>
                    <li>Sp Attack: {prop.pokemon.stat.sp_attack}</li>
                    <li>Sp Defence: {prop.pokemon.stat.sp_defence}</li>
                    <li>Speed: {prop.pokemon.stat.speed}</li>
                  </ul>
                </div>
                <div>
                  <ul>
                    {prop.pokemon.moves.map((move,index)=>(
                        <React.Fragment key={index}>
                        <img src={move.type.image} className="icon-image"/>
                        <li>{move.name}</li>
                        </React.Fragment>
                   ))}
                  </ul>
                </div>
            </div>
          )
        }
        else{
            return(<div></div>)
        }
        
    }


    function List(){
        const { useEffect, useState } = React;
        const [currentIndex, setIndex] = React.useState(0)
        const [pokemonList, setPokemonList] = React.useState([])

        useEffect(() => {
            fetch('/pokemon')
            .then(response=>response.json())
            .then(result=>{
              setPokemonList(result.pokemon)
              
            })
          }, []);

        const selectPrevious = () => {
           if (currentIndex > 0) {
            setIndex(currentIndex - 1);
            }
            else{
                fetch("/pokemon-previous")
                .then(response=>response.json())
                .then(result=>{
                    setIndex(result.index)
                    setPokemonList(result.pokemon)
                })
            }
        };
    
        const selectNext = () => {
            if (currentIndex < pokemonList.length - 1) {
                setIndex(currentIndex + 1);
            }
            else{
                fetch("/pokemon-next")
                .then(response=>response.json())
                .then(result=>{
                    setIndex(result.index)
                    setPokemonList(result.pokemon)
                })
            }
        };

        const selectItem = () => {
            fetch(`pokemon/${pokemonList[currentIndex].name}`)
                .then(response=>response.json())
                .then(result=>{
                    ReactDOM.render(<Detail pokemon={result.pokemon}/>, document.getElementById("detail"));
                })



             
        };

        return (
            <div>
            <ul>
                {pokemonList.map((item, index) => (
                    <li className={index === currentIndex ? 'selected' : ''}
                        key={item.id}
                    >
                        {item.name}
                    </li>
                ))}
            </ul>
            <button onClick={selectPrevious}>Up</button>
            <button onClick={selectNext}>Down</button>
            <button onClick={selectItem}>Enter</button>
        </div>
        );
    }

    ReactDOM.render(<List />, document.getElementById("list"));
    ReactDOM.render(<Detail />, document.getElementById("detail"));
</script>

{%endblock%}
